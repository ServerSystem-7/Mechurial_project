<script src="https://code.jquery.com/jquery-1.12.4.js"></script>


  

        <!-- wrapper -->
        <div class ="wrapper">
            <h2 class="h2">회원정보 입력</h2>
            <!-- content-->
            <div id="content">
                <div>
                    <form action="/signUp/create" method="POST">
                    <!-- ID -->
                        <flaot:left>
                        <h3 class="join_title">
                            <label for="id">아이디</label>
                        </h3>
                        <span class="box int_id">
                            <input type="text" id="id" name="id" class="int" maxlength="20">
                        </span>

                        
                        <span class="error_next_box"></span>
                    </flaot:left>

                    <!-- 아이디 중복 확인 BTN-->
                    <div class="btn_area_idCheck">
                        <button type="button" id="idChk" onclick="idCheck()">
                            <span>중복 확인</span>
                        </button>
                    </div>
                </div>

                <!-- PW1 -->
                <div>
                    <h3 class="join_title"><label for="pswd1">비밀번호</label></h3>
                    <span class="box int_pass">
                        <input type="password" id="pswd1" name="pw1" class="int" maxlength="20">
                        <span id="alertTxt">사용불가</span>
                        
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- PW2 -->
                <div>
                    <h3 class="join_title"><label for="pswd2">비밀번호 재확인</label></h3>
                    <span class="box int_pass_check">
                        <input type="password" id="pswd2" name="pw2" class="int" maxlength="20" onchange="check_pw()" >
                        <img src="../public/images/m_icon_check_disable.png" id="pswd2_img1" name="pswd2_img1" class="pswdImg">
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 이메일 -->
                <div>
                    <h3 class="join_title">
                        <label for="id">이메일</label>
                    </h3>
                    <span class="box int_id">
                        <input type="text" id="EA" name="EA" class="int" maxlength="225">
                    </span>
                    <span class="error_next_box"></span>
                </div>

                <!-- 이메일 인증 BTN-->
                <div class="btn_area_email1">
                    <button type="button" id="emailSendBtn"onclick="emailSend('EA')">
                        <span>이메일 인증</span>
                    </button>
                </div>
                
                <!-- 이메일 인증번호  -->
                <div>
                    <h3 class="join_title"><label for="email">이메일 인증번호<span class="optional"></span></label></h3>
                    <span class="box int_email">
                        <input type="text" id="CEA" name="CEA" class="int" maxlength="100" placeholder="이메일 인증번호 입력">
                    </span>
                    <span class="error_next_box">인증번호를 다시 확인해주세요.</span>    
                </div>

                <!-- 이메일 인증 확인 BTN-->
                <div class="btn_area_email2">
                    <button type="button" id="emailCertBtn" onclick="emailCer('CEA')">
                        <span>인증 확인</span>
                    </button>
                </div>

                <!-- JOIN BTN-->
                <div class="btn_area_join">
                    <button type="button" id="btnJoin" class="ajaxsend">
                        <span>가입하기</span>
                    </button>
                </div>

            </form>

                
            </div> 
            <!-- content-->

        </div> 
        <!-- wrapper -->
    <script>

    var isCoincidePw = false;
    var isAuthedEA = false;

    function check_pw() {
        var pw1 = document.getElementsByName('pw1')[0].value; 
        var pw2 = document.getElementsByName('pw2')[0].value;
            
        if(pw1===pw2){       
            document.getElementById('pswd2_img1').src="../public/images/m_icon_check_able.png"
            isCoincidePw=true;
            console.log(isCoincidePw);
        }
    }

    function idCheck() {
        var id = document.getElementsByName('id')[0].value;
        console.log("작동중");

        $.ajax({
            type: 'POST',
            url: '/signUp/idChk',
            dataType: 'json',
            data: {
                id: id
            },
            success : function(data){
                console.log(data);
                if(data)
                    alert("사용 가능한 아이디입니다.");
                else{
                    alert("사용 불가능한 아이디 입니다. 다시 입력해주세요.");
                    document.getElementsByName('id')[0].value="";
                }
            }
        });
    }

  

    document.querySelector('.ajaxsend').addEventListener('click', function() {
        var id = document.getElementsByName('id')[0].value;
        var pw = document.getElementsByName('pw1')[0].value; 
        var EA = document.getElementsByName('EA')[0].value;
        
        if ((isCoincidePw==true) && (isAuthedEA==true) ){
            sendIdPw(id, pw, EA);
        }else if ((isCoincidePw==true) && (isAuthedEA ==false) ){
            alert("이메일 인증을 다시 확인해주세요.");
        }else if((isCoincidePw==false) && (isAuthedEA==true)){
            alert("비밀번호를 다시 확인해주세요.");
        }else {
            alert("입력한 내용을 다시 확인해주세요.");
        }
        

    })

    function sendIdPw(userId, userPw, email) {
        console.log("입력된 아이디는 "+userId+" 입니다.");
        console.log("입력된 비밀번호는 "+userPw+" 입니다.");
        console.log("입력된 이메일은 "+email+" 입니다.");

        $.ajax({
            type: 'POST',
            url: '/signUp/create',
            dataType: 'json',
            data: {
                id : userId,
                pw : userPw,
                em: email
            }
        });
        location.href="/signUp/complete";

    }


    //이메일 추출
    function emailSend(email) {
		var EA = document.getElementsByName(email)[0].value;
		emailSendAjax(EA);
	}

	// 인증번호 ajax전송
	function emailCer(cerNum) {
		var CEA = document.getElementsByName(cerNum)[0].value;
		emailCerAjax(CEA);
	}


    // 이메일 전송 기능
    function emailSendAjax(email) {
         console.log("입력된 이메일은 "+email+" 입니다.");
        $.ajax({
            type: 'POST',
            url: '/signUp_emailAuth',
            dataType: 'json',
            data: {
                EA: email
            }
        });
        }


        // 이메일 인증 기능
        function emailCerAjax(cerNum) {
            $.ajax({
                type: 'POST',
                url: '/signUp_emailCert',
                dataType: 'json',
                data: {
                    CEA: cerNum,
                    isAuthedEA : isAuthedEA
                }, success: function(data){
                    if(data){
                        alert('이메일 인증에 성공했습니다.');
                        isAuthedEA=data;
                        console.log(isAuthedEA);
                    }
                    else{
                        alert('인증번호가 일치하지 않습니다.');
                        document.getElementById('CEA').value='';
                    }
                }
                
            });
        }

    </script>
